This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/
  settings.local.json
bin/
  console
  setup
exe/
  tayo
lib/
  tayo/
    commands/
      cf.rb
      gh.rb
      init.rb
    cli.rb
    version.rb
  tayo.rb
sig/
  tayo.rbs
.gitignore
Gemfile
Rakefile
README.md
tayo.gemspec
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(rg:*)",
      "Bash(mv:*)",
      "Bash(bundle update:*)",
      "Bash(chmod:*)",
      "Bash(ls:*)",
      "Bash(git init:*)",
      "Bash(git add:*)",
      "Bash(rake build)",
      "Bash(git commit:*)",
      "Bash(gh repo create:*)",
      "Bash(gem push:*)",
      "Bash(gem owner:*)",
      "Bash(gem signout:*)",
      "Bash(gem help:*)",
      "Bash(gem:*)",
      "Bash(mkdir:*)",
      "Bash(git push:*)"
    ],
    "deny": []
  }
}
</file>

<file path="bin/console">
#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "tayo"

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.

require "irb"
IRB.start(__FILE__)
</file>

<file path="bin/setup">
#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
set -vx

bundle install

# Do any other automated setup that you need to do here
</file>

<file path="exe/tayo">
#!/usr/bin/env ruby

require "tayo"

Tayo::CLI.start(ARGV)
</file>

<file path="lib/tayo/cli.rb">
# frozen_string_literal: true

require "thor"
require "colorize"
require_relative "commands/init"
require_relative "commands/gh"
require_relative "commands/cf"

module Tayo
  class CLI < Thor
    desc "init", "Rails í”„ë¡œì íŠ¸ì— Tayoë¥¼ ì„¤ì •í•©ë‹ˆë‹¤"
    def init
      Commands::Init.new.execute
    end

    desc "gh", "GitHub ì €ì¥ì†Œì™€ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤"
    def gh
      Commands::Gh.new.execute
    end

    desc "cf", "Cloudflare DNSë¥¼ ì„¤ì •í•˜ì—¬ í™ˆì„œë²„ì— ë„ë©”ì¸ì„ ì—°ê²°í•©ë‹ˆë‹¤"
    def cf
      Commands::Cf.new.execute
    end

    desc "version", "Tayo ë²„ì „ì„ í‘œì‹œí•©ë‹ˆë‹¤"
    def version
      puts "Tayo #{VERSION}"
    end
  end
end
</file>

<file path="lib/tayo.rb">
# frozen_string_literal: true

require_relative "tayo/version"
require_relative "tayo/cli"

module Tayo
  class Error < StandardError; end
end
</file>

<file path="sig/tayo.rbs">
module Tayo
  VERSION: String
  # See the writing guide of rbs: https://github.com/ruby/rbs#guides
end
</file>

<file path=".gitignore">
*.gem
*.rbc
/.config
/coverage/
/InstalledFiles
/pkg/
/spec/reports/
/spec/examples.txt
/test/tmp/
/test/version_tmp/
/tmp/
.DS_Store

# Used by dotenv library to load environment variables.
# .env

# Ignore Byebug command history file.
.byebug_history

## Specific to RubyMotion:
.dat*
.repl_history
build/
*.bridgesupport
build-iPhoneOS/
build-iPhoneSimulator/

## Documentation cache and generated files:
/.yardoc/
/_yardoc/
/doc/
/rdoc/

## Environment normalization:
/.bundle/
/vendor/bundle
/lib/bundler/man/

# for a library or gem, you might want to ignore these files since the code is
# intended to run in multiple environments; otherwise, check them in:
# Gemfile.lock
# .ruby-version
# .ruby-gemset

# unless supporting rvm < 1.11.0 or doing something fancy, ignore this:
.rvmrc

# Used by RuboCop. Remote config files pulled in from inherit_from directive.
# .rubocop-https?--*
</file>

<file path="Gemfile">
# frozen_string_literal: true

source "https://rubygems.org"

# Specify your gem's dependencies in tayo.gemspec
gemspec

gem "irb"
gem "rake", "~> 13.0"
</file>

<file path="Rakefile">
# frozen_string_literal: true

require "bundler/gem_tasks"
task default: %i[]
</file>

<file path="README.md">
# Tayo

Rails ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™ˆì„œë²„ì— ë°°í¬í•˜ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.

## ì„¤ì¹˜

ì‹œìŠ¤í…œ ì™€ì´ë“œë¡œ ì„¤ì¹˜:

```bash
gem install tayo
```

## ì‚¬ìš©ë²•

### 1. `tayo init` - Rails í”„ë¡œì íŠ¸ ì´ˆê¸°í™”

Rails í”„ë¡œì íŠ¸ë¥¼ í™ˆì„œë²„ ë°°í¬ë¥¼ ìœ„í•´ ì¤€ë¹„í•©ë‹ˆë‹¤.

```bash
tayo init
```

ì´ ëª…ë ¹ì–´ëŠ” ë‹¤ìŒ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- **OrbStack ì„¤ì¹˜ í™•ì¸**: Docker ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ OrbStackì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤
- **Gemfile ìˆ˜ì •**: development ê·¸ë£¹ì— tayo gemì„ ì¶”ê°€í•©ë‹ˆë‹¤
- **Bundle ì„¤ì¹˜**: ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤
- **Linux í”Œë«í¼ ì¶”ê°€**: `x86_64-linux`ì™€ `aarch64-linux` í”Œë«í¼ì„ Gemfile.lockì— ì¶”ê°€í•©ë‹ˆë‹¤
- **Dockerfile ìƒì„±**: Rails 7 ê¸°ë³¸ Dockerfileì´ ì—†ìœ¼ë©´ ìƒì„±í•©ë‹ˆë‹¤
- **Welcome í˜ì´ì§€ ìƒì„±**: 
  - `app/controllers/welcome_controller.rb` ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
  - `app/views/welcome/index.html.erb` ë·° íŒŒì¼ ìƒì„± (ì• ë‹ˆë©”ì´ì…˜ì´ ìˆëŠ” ì˜ˆìœ ëœë”© í˜ì´ì§€)
  - `config/routes.rb`ì— `root 'welcome#index'` ì„¤ì • ì¶”ê°€
- **Git ì»¤ë°‹**: ë³€ê²½ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ì»¤ë°‹í•©ë‹ˆë‹¤
- **Docker ìºì‹œ ì •ë¦¬**: ë””ìŠ¤í¬ ê³µê°„ í™•ë³´ë¥¼ ìœ„í•´ Docker ìºì‹œë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤

### 2. `tayo gh` - GitHub ì €ì¥ì†Œ ë° Container Registry ì„¤ì •

GitHub ì €ì¥ì†Œë¥¼ ìƒì„±í•˜ê³  Container Registryë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```bash
tayo gh
```

ì´ ëª…ë ¹ì–´ëŠ” ë‹¤ìŒ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- **GitHub CLI ì„¤ì¹˜ í™•ì¸**: `gh` ëª…ë ¹ì–´ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤
- **GitHub ì¸ì¦ í™•ì¸**: 
  - GitHubì— ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  - í•„ìš”í•œ ê¶Œí•œ(repo, read:org, write:packages) í™•ì¸
  - ê¶Œí•œì´ ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì €ì—ì„œ í† í° ìƒì„± í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤
- **Git ì €ì¥ì†Œ ì´ˆê¸°í™”**: ì•„ì§ git ì €ì¥ì†Œê°€ ì•„ë‹ˆë©´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤
- **GitHub ì›ê²© ì €ì¥ì†Œ ì„¤ì •**:
  - ê¸°ì¡´ ì›ê²© ì €ì¥ì†Œê°€ ìˆìœ¼ë©´ ì‚¬ìš©
  - ì—†ìœ¼ë©´ ìƒˆ ì €ì¥ì†Œ ìƒì„± (public/private ì„ íƒ ê°€ëŠ¥)
  - ì½”ë“œë¥¼ GitHubì— í‘¸ì‹œ
- **GitHub Container Registry ì„¤ì •**:
  - Registry URL ìƒì„±: `ghcr.io/username/repository-name`
  - Dockerë¡œ ìë™ ë¡œê·¸ì¸ ì‹¤í–‰
- **ë°°í¬ ì„¤ì • íŒŒì¼ ìƒì„±**:
  - `config/deploy.yml` íŒŒì¼ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
  - ì„œë²„ IP, ë„ë©”ì¸, ë°ì´í„°ë² ì´ìŠ¤ ë“± ì„¤ì • í¬í•¨
- **í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì¤€ë¹„**:
  - `.env.production` íŒŒì¼ ìƒì„±
  - `.gitignore`ì— ì¶”ê°€í•˜ì—¬ ë³´ì•ˆ ìœ ì§€

### 3. `tayo cf` - Cloudflare DNS ì„¤ì •

Cloudflareë¥¼ í†µí•´ ë„ë©”ì¸ì„ í™ˆì„œë²„ IPì— ì—°ê²°í•©ë‹ˆë‹¤.

```bash
tayo cf
```

ì´ ëª…ë ¹ì–´ëŠ” ë‹¤ìŒ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- **ì„¤ì • íŒŒì¼ í™•ì¸**: `config/deploy.yml` íŒŒì¼ì—ì„œ ì„œë²„ IPì™€ ë„ë©”ì¸ ì •ë³´ë¥¼ ì½ìŠµë‹ˆë‹¤
- **Cloudflare ì¸ì¦**:
  - API í† í° ì…ë ¥ ìš”ì²­ (ì²˜ìŒ ì‹¤í–‰ ì‹œ)
  - í† í°ì„ ì•ˆì „í•˜ê²Œ ì €ì¥ (macOS Keychain ì‚¬ìš©)
- **ë„ë©”ì¸ Zone í™•ì¸**: 
  - Cloudflare ê³„ì •ì—ì„œ ë„ë©”ì¸ì„ ì°¾ìŠµë‹ˆë‹¤
  - Zone IDë¥¼ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤
- **DNS ë ˆì½”ë“œ ìƒì„±/ì—…ë°ì´íŠ¸**:
  - A ë ˆì½”ë“œ ìƒì„±: ë„ë©”ì¸ì„ ì„œë²„ IPì— ì—°ê²°
  - ê¸°ì¡´ ë ˆì½”ë“œê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
  - Proxied ì„¤ì • (Cloudflare CDN ì‚¬ìš©)
- **ì„¤ì • ì™„ë£Œ í™•ì¸**:
  - DNS ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
  - ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì† ê°€ëŠ¥í•¨ì„ ì•ˆë‚´

ê° ëª…ë ¹ì–´ëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰ ìƒí™©ì„ í‘œì‹œí•˜ë©°, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì¹œì ˆí•œ ì•ˆë‚´ ë©”ì‹œì§€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

rails new ë¡œ í”„ë¡œì íŠ¸ ìƒì„± í›„ 
bundle exec tayo init
bundle exec tayo gh
bundle exec tayo cf

ìˆœìœ¼ë¡œ ì§„í–‰ í›„
bin/kamal setup ìœ¼ë¡œ ë°°í¬ ì§„í–‰
</file>

<file path="lib/tayo/commands/cf.rb">
# frozen_string_literal: true

require "colorize"
require "tty-prompt"
require "net/http"
require "json"
require "uri"

module Tayo
  module Commands
    class Cf
      def execute
        puts "â˜ï¸  Cloudflare DNS ì„¤ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤...".colorize(:green)

        unless rails_project?
          puts "âŒ Rails í”„ë¡œì íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤. Rails í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:red)
          return
        end

        # 1. ë„ë©”ì¸ ì…ë ¥ë°›ê¸°
        domain_info = get_domain_input
        
        # 2. Cloudflare í† í° ìƒì„± í˜ì´ì§€ ì—´ê¸° ë° ê¶Œí•œ ì•ˆë‚´
        open_token_creation_page
        
        # 3. í† í° ì…ë ¥ë°›ê¸°
        token = get_cloudflare_token
        
        # 4. Cloudflare APIë¡œ ë„ë©”ì¸ ëª©ë¡ ì¡°íšŒ ë° ì„ íƒ
        selected_zone = select_cloudflare_zone(token)
        
        # 5. ë£¨íŠ¸ ë„ë©”ì¸ ë ˆì½”ë“œ í™•ì¸
        existing_records = check_existing_records(token, selected_zone, domain_info)
        
        # 6. DNS ë ˆì½”ë“œ ì¶”ê°€/ìˆ˜ì •
        setup_dns_record(token, selected_zone, domain_info, existing_records)
        
        # 7. config/deploy.yml ì—…ë°ì´íŠ¸
        update_deploy_config(domain_info)

        puts "\nğŸ‰ Cloudflare DNS ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!".colorize(:green)
        
        # ë³€ê²½ì‚¬í•­ ì»¤ë°‹
        commit_cloudflare_changes(domain_info)
      end

      private

      def rails_project?
        File.exist?("Gemfile") && File.exist?("config/application.rb")
      end

      def get_domain_input
        prompt = TTY::Prompt.new
        
        puts "\nğŸ“ ë°°í¬í•  ë„ë©”ì¸ì„ ì„¤ì •í•©ë‹ˆë‹¤.".colorize(:yellow)
        
        domain = prompt.ask("ë°°í¬í•  ë„ë©”ì¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: myapp.com, api.example.com):") do |q|
          q.validate(/\A[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\z/, "ì˜¬ë°”ë¥¸ ë„ë©”ì¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: myapp.com)")
        end
        
        # ë„ë©”ì¸ì´ ë£¨íŠ¸ì¸ì§€ ì„œë¸Œë„ë©”ì¸ì¸ì§€ íŒë‹¨
        parts = domain.split('.')
        if parts.length == 2
          { type: :root, domain: domain, zone: domain }
        else
          zone = parts[-2..-1].join('.')
          { type: :subdomain, domain: domain, zone: zone, subdomain: parts[0..-3].join('.') }
        end
      end

      def open_token_creation_page
        puts "\nğŸ”‘ Cloudflare API í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.".colorize(:yellow)
        puts "í† í° ìƒì„± í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤...".colorize(:cyan)
        
        # Cloudflare API í† í° ìƒì„± í˜ì´ì§€ ì—´ê¸°
        system("open 'https://dash.cloudflare.com/profile/api-tokens'")
        
        puts "\në‹¤ìŒ ê¶Œí•œìœ¼ë¡œ í† í°ì„ ìƒì„±í•´ì£¼ì„¸ìš”:".colorize(:yellow)
        puts ""
        puts "í•œêµ­ì–´ í™”ë©´:".colorize(:gray)
        puts "â€¢ ì˜ì—­ â†’ DNS â†’ ì½ê¸°".colorize(:white)
        puts "â€¢ ì˜ì—­ â†’ DNS â†’ í¸ì§‘".colorize(:white)
        puts "  (ì˜ì—­ ë¦¬ì†ŒìŠ¤ëŠ” 'ëª¨ë“  ì˜ì—­' ì„ íƒ)".colorize(:gray)
        puts ""
        puts "English:".colorize(:gray)
        puts "â€¢ Zone â†’ DNS â†’ Read".colorize(:white)
        puts "â€¢ Zone â†’ DNS â†’ Edit".colorize(:white)
        puts "  (Zone Resources: Select 'All zones')".colorize(:gray)
        puts ""
      end

      def get_cloudflare_token
        prompt = TTY::Prompt.new
        
        token = prompt.mask("ìƒì„±ëœ Cloudflare API í† í°ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:")
        
        if token.nil? || token.strip.empty?
          puts "âŒ í† í°ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.".colorize(:red)
          exit 1
        end
        
        # í† í° ìœ íš¨ì„± ê°„ë‹¨ í™•ì¸
        if test_cloudflare_token(token.strip)
          puts "âœ… í† í°ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          return token.strip
        else
          puts "âŒ í† í°ì´ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ê¶Œí•œì´ ë¶€ì¡±í•©ë‹ˆë‹¤.".colorize(:red)
          exit 1
        end
      end

      def test_cloudflare_token(token)
        uri = URI('https://api.cloudflare.com/client/v4/user/tokens/verify')
        http = Net::HTTP.new(uri.host, uri.port)
        http.use_ssl = true
        
        request = Net::HTTP::Get.new(uri)
        request['Authorization'] = "Bearer #{token}"
        request['Content-Type'] = 'application/json'
        
        response = http.request(request)
        return response.code == '200'
      rescue
        return false
      end

      def select_cloudflare_zone(token)
        puts "\nğŸŒ Cloudflare ë„ë©”ì¸ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤...".colorize(:yellow)
        
        zones = get_cloudflare_zones(token)
        
        if zones.empty?
          puts "âŒ Cloudflareì— ë“±ë¡ëœ ë„ë©”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:red)
          puts "ë¨¼ì € https://dash.cloudflare.com ì—ì„œ ë„ë©”ì¸ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.".colorize(:cyan)
          exit 1
        end
        
        prompt = TTY::Prompt.new
        zone_choices = zones.map { |zone| "#{zone['name']} (#{zone['status']})" }
        
        selected = prompt.select("ë„ë©”ì¸ì„ ì„ íƒí•˜ì„¸ìš”:", zone_choices)
        zone_name = selected.split(' ').first
        
        selected_zone = zones.find { |zone| zone['name'] == zone_name }
        puts "âœ… ì„ íƒëœ ë„ë©”ì¸: #{zone_name}".colorize(:green)
        
        return selected_zone
      end

      def get_cloudflare_zones(token)
        uri = URI('https://api.cloudflare.com/client/v4/zones')
        http = Net::HTTP.new(uri.host, uri.port)
        http.use_ssl = true
        
        request = Net::HTTP::Get.new(uri)
        request['Authorization'] = "Bearer #{token}"
        request['Content-Type'] = 'application/json'
        
        response = http.request(request)
        
        if response.code == '200'
          data = JSON.parse(response.body)
          return data['result'] || []
        else
          puts "âŒ ë„ë©”ì¸ ëª©ë¡ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: #{response.code}".colorize(:red)
          exit 1
        end
      rescue => e
        puts "âŒ API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: #{e.message}".colorize(:red)
        exit 1
      end

      def check_existing_records(token, zone, domain_info)
        puts "\nğŸ” ê¸°ì¡´ DNS ë ˆì½”ë“œë¥¼ í™•ì¸í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        zone_id = zone['id']
        zone_name = zone['name']
        
        # ë£¨íŠ¸ ë„ë©”ì¸ì˜ A/CNAME ë ˆì½”ë“œ í™•ì¸
        records = get_dns_records(token, zone_id, zone_name, ['A', 'CNAME'])
        
        puts "ê¸°ì¡´ ë ˆì½”ë“œ: #{records.length}ê°œ ë°œê²¬".colorize(:gray)
        
        return records
      end

      def get_dns_records(token, zone_id, name, types)
        records = []
        
        types.each do |type|
          uri = URI("https://api.cloudflare.com/client/v4/zones/#{zone_id}/dns_records")
          uri.query = URI.encode_www_form({
            type: type,
            name: name
          })
          
          http = Net::HTTP.new(uri.host, uri.port)
          http.use_ssl = true
          
          request = Net::HTTP::Get.new(uri)
          request['Authorization'] = "Bearer #{token}"
          request['Content-Type'] = 'application/json'
          
          response = http.request(request)
          
          if response.code == '200'
            data = JSON.parse(response.body)
            records.concat(data['result'] || [])
          end
        end
        
        return records
      rescue => e
        puts "âŒ DNS ë ˆì½”ë“œ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: #{e.message}".colorize(:red)
        return []
      end

      def setup_dns_record(token, zone, domain_info, existing_records)
        puts "\nâš™ï¸  DNS ë ˆì½”ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # í™ˆì„œë²„ IP/URL ì…ë ¥ë°›ê¸°
        prompt = TTY::Prompt.new
        
        server_info = prompt.ask("í™ˆì„œë²„ IP ë˜ëŠ” ë„ë©”ì¸ì„ ì…ë ¥í•˜ì„¸ìš”:") do |q|
          q.validate(/\A.+\z/, "ì„œë²„ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
        end
        
        # SSH ì‚¬ìš©ì ê³„ì • ì…ë ¥ë°›ê¸°
        ssh_user = prompt.ask("SSH ì‚¬ìš©ì ê³„ì •ì„ ì…ë ¥í•˜ì„¸ìš”:", default: "root")
        
        # IPì¸ì§€ ë„ë©”ì¸ì¸ì§€ íŒë‹¨
        is_ip = server_info.match?(/\A\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\z/)
        record_type = is_ip ? 'A' : 'CNAME'
        
        zone_id = zone['id']
        zone_name = zone['name']
        
        # ë„ë©”ì¸ ì •ë³´ì— ë”°ë¼ ë ˆì½”ë“œ ì„¤ì •
        final_domain = determine_final_domain(domain_info, zone_name, existing_records)
        
        # ëŒ€ìƒ ë„ë©”ì¸ì˜ ëª¨ë“  A/CNAME ë ˆì½”ë“œ í™•ì¸
        all_records = get_dns_records(token, zone_id, final_domain[:name], ['A', 'CNAME'])
        
        if all_records.any?
          existing_record = all_records.first
          
          # ë™ì¼í•œ íƒ€ì…ì´ê³  ê°™ì€ ê°’ì´ë©´ ê±´ë„ˆë›°ê¸°
          if existing_record['type'] == record_type && existing_record['content'] == server_info
            puts "âœ… DNS ë ˆì½”ë“œê°€ ì´ë¯¸ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:green)
            puts "   #{final_domain[:full_domain]} â†’ #{server_info} (#{record_type} ë ˆì½”ë“œ)".colorize(:gray)
          else
            # íƒ€ì…ì´ ë‹¤ë¥´ê±°ë‚˜ ê°’ì´ ë‹¤ë¥¸ ê²½ìš° ì‚­ì œ í›„ ì¬ìƒì„±
            puts "âš ï¸  ê¸°ì¡´ ë ˆì½”ë“œë¥¼ ì‚­ì œí•˜ê³  ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.".colorize(:yellow)
            puts "   ê¸°ì¡´: #{existing_record['content']} (#{existing_record['type']}) â†’ ìƒˆë¡œìš´: #{server_info} (#{record_type})".colorize(:gray)
            
            # ê¸°ì¡´ ë ˆì½”ë“œ ì‚­ì œ
            delete_dns_record(token, zone_id, existing_record['id'])
            
            # ìƒˆ ë ˆì½”ë“œ ìƒì„±
            create_dns_record(token, zone_id, final_domain[:name], record_type, server_info)
          end
        else
          # DNS ë ˆì½”ë“œ ìƒì„±
          create_dns_record(token, zone_id, final_domain[:name], record_type, server_info)
        end
        
        # ìµœì¢… ë„ë©”ì¸ ì •ë³´ ì €ì¥
        @final_domain = final_domain[:full_domain]
        @server_info = server_info
        @ssh_user = ssh_user
      end

      def determine_final_domain(domain_info, zone_name, existing_records)
        case domain_info[:type]
        when :root
          if existing_records.any?
            puts "âš ï¸  ë£¨íŠ¸ ë„ë©”ì¸ì— ì´ë¯¸ ë ˆì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤. app.#{zone_name}ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.".colorize(:yellow)
            { name: "app.#{zone_name}", full_domain: "app.#{zone_name}" }
          else
            { name: zone_name, full_domain: zone_name }
          end
        when :subdomain
          { name: domain_info[:domain], full_domain: domain_info[:domain] }
        end
      end

      def create_dns_record(token, zone_id, name, type, content)
        uri = URI("https://api.cloudflare.com/client/v4/zones/#{zone_id}/dns_records")
        http = Net::HTTP.new(uri.host, uri.port)
        http.use_ssl = true
        
        request = Net::HTTP::Post.new(uri)
        request['Authorization'] = "Bearer #{token}"
        request['Content-Type'] = 'application/json'
        
        data = {
          type: type,
          name: name,
          content: content,
          ttl: 300
        }
        
        request.body = data.to_json
        response = http.request(request)
        
        if response.code == '200'
          puts "âœ… DNS ë ˆì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          puts "   #{name} â†’ #{content} (#{type} ë ˆì½”ë“œ)".colorize(:gray)
        else
          puts "âŒ DNS ë ˆì½”ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: #{response.code}".colorize(:red)
          puts response.body
          exit 1
        end
      rescue => e
        puts "âŒ DNS ë ˆì½”ë“œ ìƒì„± ì¤‘ ì˜¤ë¥˜: #{e.message}".colorize(:red)
        exit 1
      end

      def delete_dns_record(token, zone_id, record_id)
        uri = URI("https://api.cloudflare.com/client/v4/zones/#{zone_id}/dns_records/#{record_id}")
        http = Net::HTTP.new(uri.host, uri.port)
        http.use_ssl = true
        
        request = Net::HTTP::Delete.new(uri)
        request['Authorization'] = "Bearer #{token}"
        request['Content-Type'] = 'application/json'
        
        response = http.request(request)
        
        if response.code == '200'
          puts "âœ… ê¸°ì¡´ DNS ë ˆì½”ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "âŒ DNS ë ˆì½”ë“œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: #{response.code}".colorize(:red)
          puts response.body
          exit 1
        end
      rescue => e
        puts "âŒ DNS ë ˆì½”ë“œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: #{e.message}".colorize(:red)
        exit 1
      end

      def update_deploy_config(domain_info)
        puts "\nğŸ“ ë°°í¬ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        config_file = "config/deploy.yml"
        
        unless File.exist?(config_file)
          puts "âš ï¸  config/deploy.yml íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        content = File.read(config_file)
        
        # proxy.host ì„¤ì • ì—…ë°ì´íŠ¸
        if content.include?("proxy:")
          content.gsub!(/(\s+host:\s+).*$/, "\\1#{@final_domain}")
        else
          # proxy ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ì¶”ê°€
          proxy_config = "\n# Proxy configuration\nproxy:\n  ssl: true\n  host: #{@final_domain}\n"
          content += proxy_config
        end
        
        # servers ì„¤ì • ì—…ë°ì´íŠ¸
        if content.match?(/servers:\s*\n\s*web:\s*\n\s*-\s*/)
          content.gsub!(/(\s*servers:\s*\n\s*web:\s*\n\s*-\s*)[\d.]+/, "\\1#{@server_info}")
        end
        
        # ssh user ì„¤ì • ì—…ë°ì´íŠ¸
        if @ssh_user && @ssh_user != "root"
          if content.match?(/^ssh:/)
            # ê¸°ì¡´ ssh ì„¹ì…˜ ì—…ë°ì´íŠ¸
            content.gsub!(/^ssh:\s*\n\s*user:\s*\w+/, "ssh:\n  user: #{@ssh_user}")
          else
            # ssh ì„¹ì…˜ ì¶”ê°€ (accessories ì„¹ì…˜ ì•ì— ì¶”ê°€)
            if content.match?(/^# Use accessory services/)
              content.gsub!(/^# Use accessory services/, "# Use a different ssh user than root\nssh:\n  user: #{@ssh_user}\n\n# Use accessory services")
            else
              # íŒŒì¼ ëì— ì¶”ê°€
              content += "\n# Use a different ssh user than root\nssh:\n  user: #{@ssh_user}\n"
            end
          end
        end
        
        File.write(config_file, content)
        puts "âœ… config/deploy.ymlì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
        puts "   proxy.host: #{@final_domain}".colorize(:gray)
        puts "   servers.web: #{@server_info}".colorize(:gray)
        puts "   ssh.user: #{@ssh_user}".colorize(:gray) if @ssh_user && @ssh_user != "root"
      end
      
      def commit_cloudflare_changes(domain_info)
        puts "\nğŸ“ ë³€ê²½ì‚¬í•­ì„ Gitì— ì»¤ë°‹í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # ë³€ê²½ëœ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
        status_output = `git status --porcelain`.strip
        
        if status_output.empty?
          puts "â„¹ï¸  ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        # Git add
        system("git add -A")
        
        # Commit ë©”ì‹œì§€ ìƒì„±
        commit_message = "Configure Cloudflare DNS settings\n\n- Setup DNS for domain: #{domain_info[:domain]}\n- Configure server IP: #{domain_info[:server_ip]}\n- Update deployment configuration\n- Add proxy host settings\n\nğŸ¤– Generated with Tayo"
        
        # Commit ì‹¤í–‰
        if system("git commit -m \"#{commit_message}\"")
          puts "âœ… ë³€ê²½ì‚¬í•­ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          
          # GitHubì— í‘¸ì‹œ
          if system("git push", out: File::NULL, err: File::NULL)
            puts "âœ… ë³€ê²½ì‚¬í•­ì´ GitHubì— í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          else
            puts "âš ï¸  GitHub í‘¸ì‹œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ 'git push'ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:yellow)
          end
        else
          puts "âŒ Git ì»¤ë°‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
        end
      end
    end
  end
end
</file>

<file path="lib/tayo/commands/gh.rb">
# frozen_string_literal: true

require "colorize"
require "json"
require "git"
require "yaml"
require "tty-prompt"

module Tayo
  module Commands
    class Gh
      def execute
        puts "ğŸš€ GitHub ì €ì¥ì†Œ ë° ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„¤ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤...".colorize(:green)

        unless rails_project?
          puts "âŒ Rails í”„ë¡œì íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤. Rails í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:red)
          return
        end

        puts "\n[1/7] GitHub CLI ì„¤ì¹˜ í™•ì¸".colorize(:blue)
        check_github_cli
        
        puts "\n[2/7] GitHub ë¡œê·¸ì¸ í™•ì¸".colorize(:blue)
        check_github_auth
        
        puts "\n[3/7] ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê¶Œí•œ í™•ì¸".colorize(:blue)
        check_container_registry_permission
        
        puts "\n[4/7] Git ì €ì¥ì†Œ ì´ˆê¸°í™”".colorize(:blue)
        init_git_repo
        
        puts "\n[5/7] GitHub ì €ì¥ì†Œ ìƒì„±".colorize(:blue)
        create_github_repository
        
        puts "\n[6/7] ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„¤ì •".colorize(:blue)
        create_container_registry
        
        puts "\n[7/7] ë°°í¬ ì„¤ì • íŒŒì¼ ìƒì„±".colorize(:blue)
        create_deploy_config

        puts "\nğŸ‰ ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!".colorize(:green)
        puts "\në‹¤ìŒ ì •ë³´ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤:".colorize(:yellow)
        puts "â€¢ GitHub ì €ì¥ì†Œ: https://github.com/#{@username}/#{@repo_name}".colorize(:cyan)
        puts "â€¢ Container Registry: #{@registry_url}".colorize(:cyan)
        puts "â€¢ ë°°í¬ ì„¤ì •: config/deploy.yml".colorize(:cyan)
        
        # ë³€ê²½ì‚¬í•­ ì»¤ë°‹
        commit_github_changes
      end

      private

      def rails_project?
        File.exist?("Gemfile") && File.exist?("config/application.rb")
      end

      def check_github_cli
        if system("gh --version", out: File::NULL, err: File::NULL)
          puts "âœ… GitHub CLIê°€ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "ğŸ“¦ GitHub CLIë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤...".colorize(:yellow)
          system("brew install gh")
          puts "âœ… GitHub CLI ì„¤ì¹˜ ì™„ë£Œ.".colorize(:green)
        end
      end

      def check_github_auth
        auth_status = `gh auth status 2>&1`
        
        unless $?.success?
          puts "ğŸ”‘ GitHub ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.".colorize(:yellow)
          puts "ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "gh auth login".colorize(:cyan)
          exit 1
        end
        
        # í† í° ë§Œë£Œ í™•ì¸
        if auth_status.include?("Token has expired") || auth_status.include?("authentication failed")
          puts "âš ï¸  GitHub í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:yellow)
          puts "ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "gh auth login".colorize(:cyan)
          exit 1
        end
        
        puts "âœ… GitHubì— ë¡œê·¸ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:green)
      end

      def check_container_registry_permission
        scopes = `gh auth status -t 2>&1`
        
        # í† í° ë§Œë£Œ í™•ì¸ (ê¶Œí•œ ì²´í¬ ì‹œì—ë„)
        if scopes.include?("Token has expired") || scopes.include?("authentication failed")
          puts "âš ï¸  GitHub í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:yellow)
          puts "ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "gh auth login".colorize(:cyan)
          exit 1
        end
        
        unless scopes.include?("write:packages") || scopes.include?("admin:packages")
          puts "âš ï¸  ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
          puts "\nTayoê°€ ì •ìƒ ì‘ë™í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ê¶Œí•œë“¤ì´ í•„ìš”í•©ë‹ˆë‹¤:".colorize(:yellow)
          puts "â€¢ repo - GitHub ì €ì¥ì†Œ ìƒì„± ë° ê´€ë¦¬".colorize(:yellow)
          puts "â€¢ read:org - ì¡°ì§ ì •ë³´ ì½ê¸°".colorize(:yellow)
          puts "â€¢ write:packages - Docker ì´ë¯¸ì§€ë¥¼ Container Registryì— í‘¸ì‹œ".colorize(:yellow)
          puts "\ní† í° ìƒì„± í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤...".colorize(:cyan)
          
          project_name = File.basename(Dir.pwd)
          token_description = "Tayo%20-%20#{project_name}"
          token_url = "https://github.com/settings/tokens/new?scopes=repo,read:org,write:packages&description=#{token_description}"
          system("open '#{token_url}'")
          
          puts "\nâœ… ë¸Œë¼ìš°ì €ì—ì„œ GitHub í† í° ìƒì„± í˜ì´ì§€ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤.".colorize(:green)
          puts "ğŸ“Œ í•„ìš”í•œ ê¶Œí•œë“¤ì´ ì´ë¯¸ ì²´í¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤:".colorize(:green)
          puts "   â€¢ repo - ì €ì¥ì†Œ ìƒì„± ë° ê´€ë¦¬".colorize(:gray)
          puts "   â€¢ read:org - ì¡°ì§ ì •ë³´ ì½ê¸°".colorize(:gray)
          puts "   â€¢ write:packages - Container Registry ì ‘ê·¼".colorize(:gray)
          
          puts "\në‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "1. í˜ì´ì§€ í•˜ë‹¨ì˜ 'Generate token' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”".colorize(:cyan)
          puts "2. ìƒì„±ëœ í† í°ì„ ë³µì‚¬í•˜ì„¸ìš”".colorize(:cyan)
          puts "3. ì•„ë˜ì— í† í°ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:".colorize(:cyan)
          
          print "\ní† í° ì…ë ¥: ".colorize(:yellow)
          token = STDIN.gets.chomp
          
          if token.empty?
            puts "âŒ í† í°ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.".colorize(:red)
            exit 1
          end
          
          # í† í°ì„ ì„ì‹œ íŒŒì¼ì— ì €ì¥í•˜ê³  gh auth login ì‹¤í–‰
          require 'tempfile'
          Tempfile.create('github_token') do |f|
            f.write(token)
            f.flush
            
            puts "\nğŸ” GitHubì— ë¡œê·¸ì¸ ì¤‘...".colorize(:yellow)
            if system("gh auth login --with-token < #{f.path}")
              puts "âœ… GitHub ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!".colorize(:green)
              puts "\në‹¤ì‹œ 'tayo gh' ëª…ë ¹ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:cyan)
            else
              puts "âŒ GitHub ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
            end
          end
          
          exit 0
        end
        
        puts "âœ… ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê¶Œí•œì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
      end

      def init_git_repo
        unless Dir.exist?(".git")
          Git.init(".")
          puts "âœ… Git ì €ì¥ì†Œë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "â„¹ï¸  Git ì €ì¥ì†Œê°€ ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:yellow)
        end

        git = Git.open(".")
        
        # HEAD ì»¤ë°‹ì´ ìˆëŠ”ì§€ í™•ì¸
        has_commits = begin
          git.log.count > 0
        rescue Git::GitExecuteError
          false
        end
        
        # git statusë¡œ ë³€ê²½ì‚¬í•­ í™•ì¸ (HEADê°€ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš©)
        has_changes = if has_commits
          git.status.untracked.any? || git.status.changed.any?
        else
          # HEADê°€ ì—†ì„ ë•ŒëŠ” ì›Œí‚¹ ë””ë ‰í† ë¦¬ì— íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
          Dir.glob("*", File::FNM_DOTMATCH).reject { |f| f == "." || f == ".." || f == ".git" }.any?
        end
        
        if has_changes
          git.add(all: true)
          git.commit("init")
          puts "âœ… ì´ˆê¸° ì»¤ë°‹ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "â„¹ï¸  ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
        end
      end

      def create_github_repository
        repo_name = File.basename(Dir.pwd)
        username = `gh api user -q .login`.strip
        
        # ì¡°ì§ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        orgs_json = `gh api user/orgs -q '.[].login' 2>/dev/null`
        orgs = orgs_json.strip.split("\n").reject(&:empty?)
        
        owner = username
        
        if orgs.any?
          prompt = TTY::Prompt.new
          choices = ["#{username} (ê°œì¸ ê³„ì •)"] + orgs.map { |org| "#{org} (ì¡°ì§)" }
          
          selection = prompt.select("ğŸ¢ ì €ì¥ì†Œë¥¼ ìƒì„±í•  ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:", choices)
          
          if selection != "#{username} (ê°œì¸ ê³„ì •)"
            owner = selection.split(" ").first
          end
        end
        
        # ì €ì¥ì†Œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        repo_exists = system("gh repo view #{owner}/#{repo_name}", out: File::NULL, err: File::NULL)
        
        if repo_exists
          puts "â„¹ï¸  GitHub ì €ì¥ì†Œê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤: https://github.com/#{owner}/#{repo_name}".colorize(:yellow)
          @repo_name = repo_name
          @username = owner
        else
          create_cmd = if owner == username
            "gh repo create #{repo_name} --private --source=. --remote=origin --push"
          else
            "gh repo create #{owner}/#{repo_name} --private --source=. --remote=origin --push"
          end
          
          result = system(create_cmd)
          
          if result
            puts "âœ… GitHub ì €ì¥ì†Œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤: https://github.com/#{owner}/#{repo_name}".colorize(:green)
            @repo_name = repo_name
            @username = owner
          else
            puts "âŒ GitHub ì €ì¥ì†Œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
            exit 1
          end
        end
      end

      def create_container_registry
        # Docker ì´ë¯¸ì§€ íƒœê·¸ëŠ” ì†Œë¬¸ìì—¬ì•¼ í•¨
        registry_url = "ghcr.io/#{@username.downcase}/#{@repo_name.downcase}"
        @registry_url = registry_url
        
        puts "âœ… ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
        puts "   URL: #{registry_url}".colorize(:gray)
        puts "   â„¹ï¸  ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” ì²« ì´ë¯¸ì§€ í‘¸ì‹œ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.".colorize(:gray)
        
        # Dockerë¡œ GitHub Container Registryì— ë¡œê·¸ì¸
        puts "\nğŸ³ Dockerë¡œ GitHub Container Registryì— ë¡œê·¸ì¸í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # í˜„ì¬ GitHub í† í° ê°€ì ¸ì˜¤ê¸°
        token = `gh auth token`.strip
        
        if token.empty?
          puts "âŒ GitHub í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.".colorize(:red)
          return
        end
        
        # Docker login ì‹¤í–‰
        login_cmd = "echo #{token} | docker login ghcr.io -u #{@username} --password-stdin"
        
        if system(login_cmd)
          puts "âœ… Docker ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!".colorize(:green)
          puts "   Registry: ghcr.io".colorize(:gray)
          puts "   Username: #{@username}".colorize(:gray)
        else
          puts "âŒ Docker ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
          puts "   ìˆ˜ë™ìœ¼ë¡œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "   docker login ghcr.io".colorize(:cyan)
        end
      end

      def create_deploy_config
        config_dir = "config"
        Dir.mkdir(config_dir) unless Dir.exist?(config_dir)
        
        if File.exist?("config/deploy.yml")
          puts "â„¹ï¸  ê¸°ì¡´ config/deploy.yml íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.".colorize(:yellow)
          update_kamal_config
        else
          puts "âœ… config/deploy.yml íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
          create_tayo_config
        end
      end

      private

      def update_kamal_config
        content = File.read("config/deploy.yml")
        
        # ì´ë¯¸ì§€ ì„¤ì • ì—…ë°ì´íŠ¸ (ghcr.io ì¤‘ë³µ ì œê±°)
        # @registry_urlì€ ì´ë¯¸ ghcr.ioë¥¼ í¬í•¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ê·¸ëŒ€ë¡œ ì‚¬ìš©
        content.gsub!(/^image:\s+.*$/, "image: #{@registry_url}")
        
        # registry ì„¹ì…˜ ì—…ë°ì´íŠ¸
        if content.include?("registry:")
          # ê¸°ì¡´ registry ì„¹ì…˜ ìˆ˜ì •
          # server ë¼ì¸ì´ ì£¼ì„ì²˜ë¦¬ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
          if content.match?(/^\s*#\s*server:/)
            content.gsub!(/^\s*#\s*server:\s*.*$/, "  server: ghcr.io")
          elsif content.match?(/^\s*server:/)
            content.gsub!(/^\s*server:\s*.*$/, "  server: ghcr.io")
          else
            # server ë¼ì¸ì´ ì—†ìœ¼ë©´ username ìœ„ì— ì¶”ê°€
            content.gsub!(/(\s*username:\s+)/, "  server: ghcr.io\n\\1")
          end
          # usernameë„ ì†Œë¬¸ìë¡œ ë³€í™˜
          content.gsub!(/^\s*username:\s+.*$/, "  username: #{@username.downcase}")
        else
          # registry ì„¹ì…˜ ì¶”ê°€
          registry_config = "\n# Container registry configuration\nregistry:\n  server: ghcr.io\n  username: #{@username.downcase}\n  password:\n    - KAMAL_REGISTRY_PASSWORD\n"
          content.gsub!(/^# Credentials for your image host\.\nregistry:.*?^$/m, registry_config)
        end
        
        File.write("config/deploy.yml", content)
        
        # GitHub í† í°ì„ Kamal secrets íŒŒì¼ì— ì„¤ì •
        setup_kamal_secrets
        
        puts "âœ… Container Registry ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤:".colorize(:green)
        puts "   â€¢ ì´ë¯¸ì§€: #{@registry_url}".colorize(:gray)
        puts "   â€¢ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„œë²„: ghcr.io".colorize(:gray)
        puts "   â€¢ ì‚¬ìš©ìëª…: #{@username}".colorize(:gray)
      end
      
      def setup_kamal_secrets
        # .kamal ë””ë ‰í† ë¦¬ ìƒì„±
        Dir.mkdir(".kamal") unless Dir.exist?(".kamal")
        
        # í˜„ì¬ GitHub í† í° ê°€ì ¸ì˜¤ê¸°
        token_output = `gh auth token 2>/dev/null`
        
        if $?.success? && !token_output.strip.empty?
          token = token_output.strip
          secrets_file = ".kamal/secrets"
          
          # ê¸°ì¡´ secrets íŒŒì¼ ì½ê¸° (ìˆë‹¤ë©´)
          existing_content = File.exist?(secrets_file) ? File.read(secrets_file) : ""
          
          # KAMAL_REGISTRY_PASSWORDê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
          if existing_content.include?("KAMAL_REGISTRY_PASSWORD")
            # ê¸°ì¡´ ê°’ ì—…ë°ì´íŠ¸
            updated_content = existing_content.gsub(/^KAMAL_REGISTRY_PASSWORD=.*$/, "KAMAL_REGISTRY_PASSWORD=#{token}")
          else
            # ìƒˆë¡œ ì¶”ê°€
            updated_content = existing_content.empty? ? "KAMAL_REGISTRY_PASSWORD=#{token}\n" : "#{existing_content.chomp}\nKAMAL_REGISTRY_PASSWORD=#{token}\n"
          end
          
          File.write(secrets_file, updated_content)
          puts "âœ… GitHub í† í°ì´ .kamal/secretsì— ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          
          # .gitignoreì— secrets íŒŒì¼ ì¶”ê°€
          add_to_gitignore(".kamal/secrets")
        else
          puts "âš ï¸  GitHub í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”:".colorize(:yellow)
          puts "   echo 'KAMAL_REGISTRY_PASSWORD=your_github_token' >> .kamal/secrets".colorize(:cyan)
        end
      end
      
      def add_to_gitignore(file_path)
        gitignore_file = ".gitignore"
        
        if File.exist?(gitignore_file)
          content = File.read(gitignore_file)
          unless content.include?(file_path)
            File.write(gitignore_file, "#{content.chomp}\n#{file_path}\n")
            puts "âœ… .gitignoreì— #{file_path}ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
          end
        else
          File.write(gitignore_file, "#{file_path}\n")
          puts "âœ… .gitignore íŒŒì¼ì„ ìƒì„±í•˜ê³  #{file_path}ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
        end
      end

      def create_tayo_config
        deploy_config = {
          "production" => {
            "registry" => @registry_url,
            "repository" => "https://github.com/#{@username}/#{@repo_name}",
            "server" => {
              "host" => "your-home-server.local",
              "user" => "deploy",
              "port" => 22
            },
            "environment" => {
              "RAILS_ENV" => "production",
              "RAILS_MASTER_KEY" => "your-master-key"
            }
          }
        }
        
        File.write("config/deploy.yml", deploy_config.to_yaml)
        puts "   âš ï¸  ì„œë²„ ì •ë³´ì™€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.".colorize(:yellow)
      end
      
      def commit_github_changes
        puts "\nğŸ“ ë³€ê²½ì‚¬í•­ì„ Gitì— ì»¤ë°‹í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # ë³€ê²½ëœ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
        status_output = `git status --porcelain`.strip
        
        if status_output.empty?
          puts "â„¹ï¸  ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        # Git add
        system("git add -A")
        
        # Commit ë©”ì‹œì§€ ìƒì„±
        commit_message = "Add GitHub Container Registry configuration\n\n- Setup GitHub repository: #{@repo_name}\n- Configure container registry: #{@registry_url}\n- Add deployment configuration files\n- Setup environment variables\n\nğŸ¤– Generated with Tayo"
        
        # Commit ì‹¤í–‰
        if system("git commit -m \"#{commit_message}\"")
          puts "âœ… ë³€ê²½ì‚¬í•­ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          
          # GitHubì— í‘¸ì‹œ
          if system("git push", out: File::NULL, err: File::NULL)
            puts "âœ… ë³€ê²½ì‚¬í•­ì´ GitHubì— í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          else
            puts "âš ï¸  GitHub í‘¸ì‹œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ 'git push'ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:yellow)
          end
        else
          puts "âŒ Git ì»¤ë°‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
        end
      end
    end
  end
end
</file>

<file path="tayo.gemspec">
# frozen_string_literal: true

require_relative "lib/tayo/version"

Gem::Specification.new do |spec|
  spec.name = "tayo"
  spec.version = Tayo::VERSION
  spec.authors = ["ì´ì›ì„­wonsup Lee/Alfonso"]
  spec.email = ["onesup.lee@gmail.com"]

  spec.summary = "Rails deployment tool for home servers"
  spec.description = "Tayo is a deployment tool for Rails applications to home servers using GitHub Container Registry and Cloudflare CLI."
  spec.homepage = "https://github.com/TeamMilestone/tayo"
  spec.required_ruby_version = ">= 3.1.0"

  spec.metadata["homepage_uri"] = spec.homepage
  spec.metadata["source_code_uri"] = "https://github.com/TeamMilestone/tayo"
  spec.metadata["changelog_uri"] = "https://github.com/TeamMilestone/tayo/blob/main/CHANGELOG.md"

  # Specify which files should be added to the gem when it is released.
  # The `git ls-files -z` loads the files in the RubyGem that have been added into git.
  gemspec = File.basename(__FILE__)
  spec.files = IO.popen(%w[git ls-files -z], chdir: __dir__, err: IO::NULL) do |ls|
    ls.readlines("\x0", chomp: true).reject do |f|
      (f == gemspec) ||
        f.start_with?(*%w[bin/ test/ spec/ features/ .git appveyor Gemfile])
    end
  end
  spec.bindir = "exe"
  spec.executables = spec.files.grep(%r{\Aexe/}) { |f| File.basename(f) }
  spec.require_paths = ["lib"]

  spec.add_dependency "thor", "~> 1.3"
  spec.add_dependency "git", "~> 1.18"
  spec.add_dependency "colorize", "~> 1.1"
  spec.add_dependency "tty-prompt", "~> 0.23"

  # For more information and examples about making a new gem, check out our
  # guide at: https://bundler.io/guides/creating_gem.html
end
</file>

<file path="lib/tayo/commands/init.rb">
# frozen_string_literal: true

require "colorize"

module Tayo
  module Commands
    class Init
      def execute
        puts "ğŸ  Tayo ì´ˆê¸°í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...".colorize(:green)

        unless rails_project?
          puts "âŒ Rails í”„ë¡œì íŠ¸ê°€ ì•„ë‹™ë‹ˆë‹¤. Rails í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:red)
          return
        end

        check_orbstack
        add_to_gemfile
        bundle_install
        add_linux_platform
        create_welcome_page
        commit_changes
        clear_docker_cache
        
        puts "âœ… Tayoê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!".colorize(:green)
      end

      private

      def rails_project?
        File.exist?("Gemfile") && File.exist?("config/application.rb")
      end

      def check_orbstack
        puts "ğŸ³ OrbStack ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # OrbStack ì‹¤í–‰ ìƒíƒœ í™•ì¸
        orbstack_running = system("pgrep -x OrbStack > /dev/null 2>&1")
        
        if orbstack_running
          puts "âœ… OrbStackì´ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.".colorize(:green)
        else
          puts "ğŸš€ OrbStackì„ ì‹œì‘í•©ë‹ˆë‹¤...".colorize(:yellow)
          
          # OrbStack ì‹¤í–‰
          if system("open -a OrbStack")
            puts "âœ… OrbStackì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
            
            # OrbStackì´ ì™„ì „íˆ ì‹œì‘ë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
            print "Docker ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸° ì¤‘".colorize(:yellow)
            5.times do
              sleep 1
              print ".".colorize(:yellow)
            end
            puts ""
            
            # Dockerê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if system("docker ps > /dev/null 2>&1")
              puts "âœ… Dockerê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
            else
              puts "âš ï¸  Dockerê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.".colorize(:yellow)
            end
          else
            puts "âŒ OrbStackì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.".colorize(:red)
            puts "OrbStackì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.".colorize(:yellow)
            puts "https://orbstack.dev ì—ì„œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.".colorize(:cyan)
          end
        end
      end

      def add_to_gemfile
        gemfile_content = File.read("Gemfile")
        
        if gemfile_content.include?("tayo")
          puts "â„¹ï¸  Tayoê°€ ì´ë¯¸ Gemfileì— ìˆìŠµë‹ˆë‹¤.".colorize(:yellow)
          return
        end

        development_group = gemfile_content.match(/group :development do\n(.*?)\nend/m)
        
        if development_group
          updated_content = gemfile_content.sub(
            /group :development do\n/,
            "group :development do\n  gem 'tayo'\n"
          )
        else
          updated_content = gemfile_content + "\n\ngroup :development do\n  gem 'tayo'\nend\n"
        end

        File.write("Gemfile", updated_content)
        puts "âœ… Gemfileì— Tayoë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
      end

      def bundle_install
        puts "ğŸ“¦ bundle installì„ ì‹¤í–‰í•©ë‹ˆë‹¤...".colorize(:yellow)
        system("bundle install")
      end

      def add_linux_platform
        puts "ğŸ§ Linux í”Œë«í¼ì„ í™•ì¸í•˜ê³  ì¶”ê°€í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # Gemfile.lock íŒŒì¼ í™•ì¸
        unless File.exist?("Gemfile.lock")
          puts "âš ï¸  Gemfile.lock íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. bundle installì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.".colorize(:yellow)
          return
        end
        
        gemfile_lock_content = File.read("Gemfile.lock")
        platforms_needed = []
        
        # í•„ìš”í•œ í”Œë«í¼ í™•ì¸
        unless gemfile_lock_content.include?("x86_64-linux")
          platforms_needed << "x86_64-linux"
        end
        
        unless gemfile_lock_content.include?("aarch64-linux")
          platforms_needed << "aarch64-linux"
        end
        
        if platforms_needed.empty?
          puts "âœ… í•„ìš”í•œ Linux í”Œë«í¼ì´ ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:green)
          return
        end
        
        # í”Œë«í¼ ì¶”ê°€
        platforms_needed.each do |platform|
          puts "ğŸ“¦ #{platform} í”Œë«í¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤...".colorize(:yellow)
          if system("bundle lock --add-platform #{platform}")
            puts "âœ… #{platform} í”Œë«í¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          else
            puts "âŒ #{platform} í”Œë«í¼ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:red)
          end
        end
        
        # Dockerfile í™•ì¸ ë° ìƒì„±
        ensure_dockerfile_exists
      end
      
      def ensure_dockerfile_exists
        dockerfile_created = false
        
        unless File.exist?("Dockerfile")
          puts "ğŸ³ Dockerfileì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ Dockerfileì„ ìƒì„±í•©ë‹ˆë‹¤...".colorize(:yellow)
          
          # Rails 7ì˜ ê¸°ë³¸ Dockerfile ìƒì„±
          if system("rails app:update:bin")
            system("./bin/rails generate dockerfile")
            puts "âœ… Dockerfileì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
            dockerfile_created = true
          else
            puts "âš ï¸  Dockerfile ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.".colorize(:yellow)
            puts "   ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”: ./bin/rails generate dockerfile".colorize(:cyan)
            return
          end
        else
          puts "âœ… Dockerfileì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.".colorize(:green)
        end
        
        # Dockerfileì—ì„œ bootsnap precompile ë¶€ë¶„ ì œê±° (ë¹Œë“œ ë¬¸ì œ í•´ê²°)
        fix_dockerfile_bootsnap_issue
      end
      
      def fix_dockerfile_bootsnap_issue
        return unless File.exist?("Dockerfile")
        
        dockerfile_content = File.read("Dockerfile")
        original_content = dockerfile_content.dup
        
        # Dockerfileì„ ë¼ì¸ë³„ë¡œ ì²˜ë¦¬
        lines = dockerfile_content.split("\n")
        filtered_lines = []
        skip_next = false
        
        lines.each_with_index do |line, index|
          # bootsnap ê´€ë ¨ ì£¼ì„ ì°¾ê¸°
          if line.match?(/^\s*#.*bootsnap.*faster boot times/i)
            skip_next = true  # ë‹¤ìŒ ë¼ì¸ë„ ì œê±°í•  ì¤€ë¹„
            next  # ì´ ë¼ì¸ì€ ì œê±°
          end
          
          # bootsnap precompile RUN ëª…ë ¹ ì°¾ê¸°
          if line.match?(/^\s*RUN.*bootsnap\s+precompile/i)
            skip_next = false  # ë¦¬ì…‹
            next  # ì´ ë¼ì¸ì€ ì œê±°
          end
          
          # skip_nextê°€ trueì´ê³  í˜„ì¬ ë¼ì¸ì´ RUN bootsnapì´ë©´ ì œê±°
          if skip_next && line.match?(/^\s*RUN.*bootsnap/i)
            skip_next = false
            next
          end
          
          skip_next = false
          filtered_lines << line
        end
        
        new_content = filtered_lines.join("\n") + "\n"
        
        if new_content != original_content
          File.write("Dockerfile", new_content)
          puts "âœ… Dockerfileì—ì„œ bootsnap precompile ë¶€ë¶„ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. (ë¹Œë“œ ë¬¸ì œ í•´ê²°)".colorize(:green)
          puts "   - ì´ëŠ” ì•Œë ¤ì§„ ë¹Œë“œ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.".colorize(:gray)
        end
      end

      def create_welcome_page
        # Welcome ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
        if File.exist?("app/controllers/welcome_controller.rb")
          puts "â„¹ï¸  Welcome í˜ì´ì§€ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.".colorize(:yellow)
          @welcome_page_created = false
          return
        end
        
        puts "ğŸ¨ Welcome í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # Welcome ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
        system("rails generate controller Welcome index --skip-routes --no-helper --no-assets")
        
        # í”„ë¡œì íŠ¸ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        project_name = File.basename(Dir.pwd).gsub(/[-_]/, ' ').split.map(&:capitalize).join(' ')
        
        # Welcome í˜ì´ì§€ HTML ìƒì„±
        welcome_html = <<~HTML
          <!DOCTYPE html>
          <html>
          <head>
            <title>#{project_name} - Welcome</title>
            <meta name="viewport" content="width=device-width,initial-scale=1">
            <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
              }
              .container {
                text-align: center;
                padding: 2rem;
                max-width: 800px;
                animation: fadeIn 1s ease-out;
              }
              h1 {
                font-size: 4rem;
                margin-bottom: 1rem;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                animation: slideDown 0.8s ease-out;
              }
              .subtitle {
                font-size: 1.5rem;
                margin-bottom: 3rem;
                opacity: 0.9;
                animation: slideUp 0.8s ease-out 0.2s both;
              }
              .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 2rem;
                margin-top: 3rem;
              }
              .info-card {
                background: rgba(255,255,255,0.1);
                backdrop-filter: blur(10px);
                padding: 2rem;
                border-radius: 10px;
                border: 1px solid rgba(255,255,255,0.2);
                animation: fadeIn 0.8s ease-out 0.4s both;
              }
              .info-card h3 {
                font-size: 1.2rem;
                margin-bottom: 0.5rem;
              }
              .info-card p {
                opacity: 0.8;
                font-size: 0.9rem;
              }
              .deploy-badge {
                display: inline-block;
                background: rgba(255,255,255,0.2);
                padding: 0.5rem 1rem;
                border-radius: 20px;
                margin-top: 2rem;
                font-size: 0.9rem;
                animation: pulse 2s infinite;
              }
              @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
              }
              @keyframes slideDown {
                from { opacity: 0; transform: translateY(-30px); }
                to { opacity: 1; transform: translateY(0); }
              }
              @keyframes slideUp {
                from { opacity: 0; transform: translateY(30px); }
                to { opacity: 1; transform: translateY(0); }
              }
              @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.8; }
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>ğŸ  #{project_name}</h1>
              <p class="subtitle">Welcome to your Tayo-powered Rails application!</p>
              
              <div class="info-grid">
                <div class="info-card">
                  <h3>ğŸ“¦ Container Ready</h3>
                  <p>Your app is configured for container deployment</p>
                </div>
                <div class="info-card">
                  <h3>ğŸš€ GitHub Integration</h3>
                  <p>Ready to push to GitHub Container Registry</p>
                </div>
                <div class="info-card">
                  <h3>â˜ï¸ Cloudflare DNS</h3>
                  <p>Domain management simplified</p>
                </div>
              </div>
              
              <div class="deploy-badge">
                Deployed with Tayo ğŸ‰
              </div>
            </div>
          </body>
          </html>
        HTML
        
        # Welcome ë·° íŒŒì¼ì— ì €ì¥
        welcome_view_path = "app/views/welcome/index.html.erb"
        File.write(welcome_view_path, welcome_html)
        
        # routes.rb ì—…ë°ì´íŠ¸
        routes_file = "config/routes.rb"
        routes_content = File.read(routes_file)
        
        # root ê²½ë¡œ ì„¤ì • - welcome#indexê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
        unless routes_content.include?("welcome#index")
          if routes_content.match?(/^\s*root\s+/)
            # ê¸°ì¡´ root ì„¤ì •ì´ ìˆìœ¼ë©´ êµì²´
            routes_content.gsub!(/^\s*root\s+.*$/, "  root 'welcome#index'")
          else
            # root ì„¤ì •ì´ ì—†ìœ¼ë©´ ì¶”ê°€
            routes_content.gsub!(/Rails\.application\.routes\.draw do\s*\n/, "Rails.application.routes.draw do\n  root 'welcome#index'\n")
          end
          
          File.write(routes_file, routes_content)
          puts "   âœ… routes.rbì— root ê²½ë¡œë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "   â„¹ï¸  routes.rbì— welcome#indexê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.".colorize(:yellow)
        end
        
        puts "âœ… Welcome í˜ì´ì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!".colorize(:green)
        puts "   ê²½ë¡œ: /".colorize(:gray)
        puts "   ì»¨íŠ¸ë¡¤ëŸ¬: app/controllers/welcome_controller.rb".colorize(:gray)
        puts "   ë·°: app/views/welcome/index.html.erb".colorize(:gray)
        
        @welcome_page_created = true
      end

      def commit_changes
        # Git ì €ì¥ì†Œì¸ì§€ í™•ì¸
        unless Dir.exist?(".git")
          puts "âš ï¸  Git ì €ì¥ì†Œê°€ ì•„ë‹™ë‹ˆë‹¤. ì»¤ë°‹ì„ ê±´ë„ˆëœë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        # Welcome í˜ì´ì§€ê°€ ìƒˆë¡œ ìƒì„±ëœ ê²½ìš°ì—ë§Œ ì»¤ë°‹
        unless @welcome_page_created
          puts "â„¹ï¸  ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ ì»¤ë°‹ì„ ê±´ë„ˆëœë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        puts "ğŸ“ ë³€ê²½ì‚¬í•­ì„ Gitì— ì»¤ë°‹í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # Git ìƒíƒœ í™•ì¸
        git_status = `git status --porcelain`
        
        if git_status.strip.empty?
          puts "â„¹ï¸  ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.".colorize(:yellow)
          return
        end
        
        # ë³€ê²½ì‚¬í•­ ìŠ¤í…Œì´ì§•
        system("git add .")
        
        # ì»¤ë°‹
        commit_message = "Add Tayo configuration and Welcome page"
        if system("git commit -m '#{commit_message}'")
          puts "âœ… ë³€ê²½ì‚¬í•­ì´ ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          puts "   ì»¤ë°‹ ë©”ì‹œì§€: #{commit_message}".colorize(:gray)
        else
          puts "âš ï¸  ì»¤ë°‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:yellow)
        end
      end

      def clear_docker_cache
        puts "ğŸ§¹ Docker ìºì‹œë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤...".colorize(:yellow)
        
        # Docker system prune
        if system("docker system prune -f > /dev/null 2>&1")
          puts "âœ… Docker ì‹œìŠ¤í…œ ìºì‹œê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
        else
          puts "âš ï¸  Docker ì‹œìŠ¤í…œ ì •ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:yellow)
        end
        
        # Kamal build cache clear
        if File.exist?("config/deploy.yml")
          puts "ğŸš¢ Kamal ë¹Œë“œ ìºì‹œë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤...".colorize(:yellow)
          if system("kamal build --clear-cache > /dev/null 2>&1")
            puts "âœ… Kamal ë¹Œë“œ ìºì‹œê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.".colorize(:green)
          else
            puts "âš ï¸  Kamal ë¹Œë“œ ìºì‹œ ì •ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.".colorize(:yellow)
          end
        end
      end
    end
  end
end
</file>

<file path="lib/tayo/version.rb">
# frozen_string_literal: true

module Tayo
  VERSION = "0.1.5"
end
</file>

</files>
